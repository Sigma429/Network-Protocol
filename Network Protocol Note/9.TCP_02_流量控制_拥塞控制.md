## 1.流量控制

接收方会告诉发送方接收窗口的大小（比如，400），意味着发送方最多发送400数据

窗口大小是动态调整的，接收方给回确认的过程中，发送方会调整此时的发送窗口大小

接收窗口大小与缓存区有关

![image-20230925174240862](imgs\image-20230925174240862.png)

![image-20230925195909387](imgs\image-20230925195909387.png)

![image-20230925202614011](imgs\image-20230925202614011.png)

## 2.拥塞控制

### 2.1概述

引发原因：过度使用网络带宽，当网络中的流量超过了可用带宽的容量时，就会发生拥塞。

每个主机去进行拥塞控制，链路的吞吐量就少了，共同来维护

![image-20230925204306822](imgs\image-20230925204306822.png)

![image-20230925210630990](imgs\image-20230925210630990.png)



### 2.2方法

#### 2.2.1介绍

建立连接时， 发送方是1460，接收方是1412，通信过程中使用的传输层的段，其数据大小取双方中的最小值1412（协商），

 MSS只会在建立连接时确定（在选项部分），其他时候都看不见

接收窗口大小，就是接收方告诉发送方，发送数据的最大值（所有数据包一次性发过来，最多发多少个，不是指每个包最大为多少）

**swnd = min ( cwnd , rwnd )** ，发送窗口取接收窗口和拥塞窗口两者的最小值

拥塞窗口在发送方，会进行拥塞控制，大小变动，发送窗口为实际发送的大小

拥塞窗口大小 > 接收窗口大小，取接收窗口大小

拥塞窗口大小 < 接收窗口大小，取拥塞窗口大小

![image-20230925230628324](imgs\image-20230925230628324.png)

![image-20230925211446350](imgs\image-20230925211446350.png)

![image-20230925212115432](imgs\image-20230925212115432.png)

![image-20230926153124483](imgs\image-20230926153124483.png)

#### 2.2.2慢开始

发送的包的数量成指数式增长

刚开始发的时候，拥塞窗口大小是一个包，也就是MSS的大小

![image-20230926112748747](imgs\image-20230926112748747.png)

数据包的数量与拥塞窗口的大小成正比（数据包大小固定，为MSS）

![image-20230926114713957](imgs\image-20230926114713957.png)

#### 2.2.3拥塞避免

判断是否拥塞，拥塞时会丢包

![image-20230926135501287](imgs\image-20230926135501287.png)



#### 2.2.4快重传  

丢包后，不告诉要快重传的话，发送方会超时重传，而快重传连续发三个重复确认后 ，发送方会立即重传丢失的包 （相当于催一下）

每收到一个失序的分组后就立即发出重复确认，而不要等待自己发送数据时才进行确认（SACK选择性确认）（其中一个丢了，要等一组全部发完，收到确认后，才进行SACK重传）

![image-20230926135726563](imgs\image-20230926135726563.png)

![image-20230926135856212](imgs\image-20230926135856212.png)

一般为超时重传，有时候会触发快重传

![image-20230926154843946](imgs\image-20230926154843946.png)

#### 2.2.5快恢复

 快恢复直接从新的阈值开始增长

![image-20230926152158516](imgs\image-20230926152158516.png)

收到三个重复确认，意味着丢包，说明路由器忙不过来，网络产生拥塞，执行快重传算法

快重传意味着网络产生拥塞

![image-20230926150658354](imgs\image-20230926150658354.png)
